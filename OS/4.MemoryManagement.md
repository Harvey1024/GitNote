# 4. 处理器管理
## 4.1 存储器的层次结构
- CPU寄存器
    - 寄存器
- 主存
    - 高速缓存
    - 主存储器
    - 磁盘存储
- 辅存（属于设备管理范畴，信息长期保存）
    - 固定磁盘
    - 可移动存储介质
## 4.2 程序的装入和链接
程序装入内存步骤：
1. 编译，编译成目标模块
2. 链接，将目标模块和库函数链接在一起
3. 装入，装入内存
### 4.2.1 程序的装入
1. 绝对装入方式
2. 可重定位装入方式
3. 动态运行时的装入方式
### 4.2.2 程序的链接
1. 静态链接Static linking
2. 装入时动态链接Load-time Dynamic Linking
3. 运行时动态链接Run-time Dynamic Linking
## 4.3 连续分配存储管理方式
1. 单一连续分配
2. 固定分区分配
3. 动态分区分配
    1. 数据结构：
        - 空闲分区表
        - 空闲分区链
    2. 分配算法
        1. 基于顺序搜索
            - 首次适应算法first fit, FF  
                从链首开始查找
            - 循环首次适应算法next fit, NF  
                从上次找到的空闲分区的下一个空闲分区开始查找
            - 最佳适应算法best fit, BF  
                空闲分区按大小排列，找到满足要求，且是最小的空闲分区
            - 最坏适应算法worst fit, WF  
                总是挑选最大的空闲分区，分割一部分给作业。
        2. 基于索引搜索的动态分区分配算法
            - 快速适应算法quick fit  
                将一类相同容量的所有空闲分区单独设立空闲分区链表，同时设立一张管理索引表  
                步骤：1)根据进程长度，找到最小的空闲分区链表，2)选链表里的第一个，不对任何分区进行分割。
            - 伙伴系统buddy system  
                将已分配分区或空闲分区大小均设为2的k次幂，将空闲分区按大小分类，相同大小的单独设立空闲分区双向链表。  
                更具进程长度查找最接近的分区，找到后对分区进行分割。
            - 哈希算法  
                根据空闲分区在空闲区表中的分配规律，建立哈希函数，构造一张以空闲分区大小为关键字的哈希表，表的每一项记录了对应空闲分区链表的表头指针。  
                进程分配时，根据所需分区大小，通过哈希函数计算，得到哈希表中的位置，得到相应的空闲分区链表，实现最佳分配策略。  
    3. 分区分配操作
        - 分配内存
        - 回收内存
4. 动态可重定位分区分配
    1. 紧凑  
        将多个分散的小分区拼接成一个大分区
    2. 动态重定位  
        重定位寄存器，用来存放程序在内存中的起始地址  
        真正访问的地址 = 相对地址 + 重定位寄存器中地址  
        地址变换过程在程序执行期间自动进行，故称为动态重定位
    3. 动态重定位算法  
        当找不到满足要求的空闲空间分区时，进行紧凑形成连续空闲空间
## 4.4 对换 Swapping  
### 4.4.1 多道程序环境下的对换技术
1. 对换的引入  
为解决进程阻塞时占用内存的问题，引入对换（交换）设施  
对换，是指把内存中暂时不能运行的进程或暂时不用的程序和数据换出到外存上，以便腾出足够的内存空间，再把已具备运行条件的进程，或进程所需的程序和数据换入到内存。
2. 对换的类型
    - 整体对换：以整个进程为单位
    - 页面（分段）对换：以进程的一个页面或分段为单位，目的是为了支持虚拟存储系统
### 4.4.2 对换空间管理
 有对换功能的OS，磁盘空间分为：文件区和对换区    
- 文件区首要目标是提高文件存储空间利用率，其次是访问速度  
- 对换区首要目标是提高进程换入换出速度，其次是空间利用率  

对换区空闲磁盘块管理中的数据结构：  
- 由空闲分区表和空闲分区链组成，空闲分区表中包含对换区的首地址及其大小

对换空间的分配和回收算法和动态分区方式时的内存分配和回收方法相同  

## 4.5 分页存储管理方式
### 离散分配方式
紧凑的开销大，通过将一个进程分散地装到许多不相邻的分区中，就无需紧凑，这种方式为**离散分配方式**  
离散分配方式分为三种：
1. 分页存储管理方式：将用户程序的地址空间分为若干固定大小的区域，称为“页”或“页面”，将内存空间分为若干个物理块或页框(frame)，页和块的大小相同。
2. 分段存储管理方式：将用户程序分为大小不同的段，每段定义一组完整的信息。
3. 段页式存储管理方式：结合两种方法

### 分页存储地址变换机构：
1. 基本的地址变换机构  
    进程未执行时，页表地址和页表长度放在进程的PCB中，调度时才装入**页表寄存器**
2. 具有快表的地址变换机构
    增加一个具有并行查询能力的特殊告诉缓冲寄存器（联想寄存器，或块表）  
    先将页号和高速缓冲中（块表中）的所有页号比较，在里面，则直接读取的对应的物理块号，否则再访问内存中的页表，找到后再将对应块号放入到块表中。

### 两级页表和多级页表
针对难以找到连续的较大的内存空间存放页表的问题，再将页表分为多个页表。

### 反置页表 Inverted Page Table 
为减少页表占用的内存空间，引入反置页表。  

## 4.6 分段存储管理方式
将程序分为若干段，  
分段地址结构：  
- 段号|段内地址

## 4.7 段页式存储管理方式
先将程序分为若干段，再将段分为若干页。  
为获得一条指令或数据，需要三次访问内存，增加高速缓冲寄存器，可以提高效率。
